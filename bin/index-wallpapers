#!/usr/bin/env node

const fs = require('fs')
const config = require('../config')

// get wallpapers index
fs.readdir(config.indexWallpaper.entry, (err, wallpapers) => {
    if (err) throw err

    // filter image
    wallpapers = wallpapers.filter(w => {
        const ext = w.split('.').pop()
        const whiteList = ['png', 'jpg', 'jpeg', 'gif', 'webp']
        return whiteList.indexOf(ext.toLocaleLowerCase()) !== -1
    })

    // write wallpapers index file
    fs.writeFile(
        config.indexWallpaper.output,
        `// THIS IS AN AUTOGENERATED FILE.\n// DO NOT EDIT THIS FILE DIRECTLY\nwindow.defaultWallpapers = ${JSON.stringify(wallpapers)}`,
        (err) => {
            if (err) throw err
            console.log('ðŸŒƒ Indexing wallpapers conpleted')
        }
    )
})